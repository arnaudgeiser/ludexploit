plugins {
  id 'org.hidetake.ssh' version '2.7.0'
}

remotes {
  server {
    host = '46.101.214.30'
    user = 'root'
    identity = file(System.properties['user.home']+'/.ssh/id_rsa')
  }
}

task deploy {
	doLast {
		ssh.run {
			session(remotes.server) {
				execute """mkdir -p /opt/ludexploit/versions &&
					 cd /opt/ludexploit/versions &&
					 wget http://archiva.ludine.ch/restServices/archivaServices/searchService/artifact?g=ch.waterbead&a=ludexploit&v=${versionToDeploy}&p=jar -O ${versionToDeploy}.jar &&
					 ln -sf /opt/ludexploit/versions/${versionToDeploy}.jar /opt/ludexploit/current.jar &&
					 service ludexploit restart"""
			}
		}
	}
}
